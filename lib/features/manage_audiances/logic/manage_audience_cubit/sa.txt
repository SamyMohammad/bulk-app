  ManageAudiancesCubit() : super(ManageAudiancesState.initial());
  List<Audiences>? audiences;
  late final AudienceRepository repository;

  void init() {
    emit(const ManageAudiancesState.audienceLoadingState());
    final ApiService client = getIt<ApiService>();
    repository = AudienceRepository(client);
    fetchAudienceList();
  }

  Future<void> fetchAudienceList() async {
    emit(const ManageAudiancesState.audienceLoadingState());
    try {
      final response = await repository.getAllAudiences();
      response.when(
        success: (BaseResponse<AudienceResponseData> data) {
          audiences = data.data?.audiences;
          if (audiences != null && audiences!.isNotEmpty) {
            emit(ManageAudiancesState.audienceSuccessState(audiences!));
          } else {
            emit(const ManageAudiancesState.audienceEmptyState());
          }
        },
        failure: (error) {
          emit(const ManageAudiancesState.audienceEmptyState());
        },
      );
    } catch (e) {
      emit(const ManageAudiancesState.audienceEmptyState());
    }
  }

  Future<void> delete(int id) async {
    emit(const ManageAudiancesState.audienceLoadingState());
    audiences?.removeWhere((audience) => audience.id == id);
    try {
      await repository.deleteAudienceByid(id.toString());
      emit(ManageAudiancesState.audienceSuccessState(audiences!));
    } catch (e) {
      emit(const ManageAudiancesState.audienceEmptyState());
    }
  }